# Safe Wallet UI

Frontend-приложение для работы с мультиподписными кошельками Safe (Gnosis Safe).

## Описание

Safe Wallet UI — это легковесное frontend-only приложение, которое предоставляет простой минимальный интерфейс для создания и подписания транзакций мультиподписными кошельками Safe. 

### Ключевые особенности

- **Frontend-only решение** — не требует разворачивания тяжелой экосистемы, которую предоставляет Gnosis
- **Официальный Protocol Kit** — использует официальный `@safe-global/protocol-kit` от Gnosis для подписания транзакций
- **Аудированные контракты** — не использует собственные фабрики, работает с аудированными контрактами Gnosis
- **Оффчейн сбор подписей** — подписи собираются оффчейн, без необходимости отправлять транзакции на каждом этапе
- **Приватное хранение** — подписи хранятся в приватном IPFS Pinata, не хранятся на бекенде
- **Доступ по ключу** — владельцы кошелька должны иметь ключ от Pinata для доступа к подписям
- **Бесплатный тариф** — для работы приложения достаточно бесплатного тарифа на Pinata

## Технологии

- **Vue 3** (Composition API) — основной фреймворк
- **Viem** — библиотека для работы с Ethereum
- **Protocol Kit** (`@safe-global/protocol-kit`) — официальный SDK от Gnosis для работы с Safe кошельками
- **Web3-Onboard** (`@web3-onboard/vue`) — интеграция EIP-1193 кошельков (пока поддерживается только Metamask)
- **Pinata SDK** — работа с приватным IPFS для хранения подписей
- **PrimeVue** — UI компоненты
- **Tailwind CSS** — стилизация
- **Pinia** — управление состоянием
- **Vite** — сборщик проекта

## Установка и запуск

### Требования

- Node.js (рекомендуется версия 22.14.0 или выше)
- npm (рекомендуется версия 10.9.2 или выше)

### Установка зависимостей

```bash
npm install
```

### Запуск в режиме разработки

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:5173` (или другому порту, указанному Vite).

### Сборка для production

```bash
npm run build
```

Собранные файлы будут находиться в директории `dist/`.

### Предпросмотр production сборки

```bash
npm run preview
```

## Настройка Pinata API

Для работы приложения необходимо настроить Pinata API ключ:

1. Зарегистрируйтесь на [Pinata](https://www.pinata.cloud/)
2. Создайте JWT токен в настройках аккаунта
3. В приложении перейдите в настройки аккаунта Safe и укажите Pinata API ключ

**Важно:** Все владельцы кошелька должны иметь доступ к одному и тому же Pinata API ключу для совместной работы с транзакциями.

## Использование

### Создание Safe кошелька

1. Перейдите в раздел "Accounts"
2. Нажмите "Create New"
3. Укажите владельцев кошелька и порог подписей (threshold)
4. Разверните контракт на блокчейне

### Добавление существующего Safe кошелька

1. Перейдите в раздел "Accounts"
2. Нажмите "Add"
3. Укажите адрес Safe кошелька и хеш транзакции создания
4. Приложение извлечет конфигурацию кошелька из блокчейна

### Создание транзакции

1. Выберите Safe кошелек
2. Перейдите в раздел "New Transaction"
3. Выберите контракт и метод
4. Заполните параметры транзакции
5. Подпишите транзакцию

### Подписание транзакции

1. Перейдите в раздел "Transactions"
2. Выберите транзакцию, требующую подписи
3. Нажмите "Confirm" и подпишите транзакцию

### Выполнение транзакции

Когда собрано достаточное количество подписей (достигнут threshold), транзакция может быть выполнена:

1. Перейдите в раздел "Transactions"
2. Выберите транзакцию с достаточным количеством подписей
3. Нажмите "Execute" для отправки транзакции в сеть

## Архитектура

### Хранение подписей

Подписи транзакций хранятся в приватном IPFS Pinata в формате JSON. Каждая подпись содержит:

- Данные транзакции Safe
- Подпись владельца
- Метаданные (nonce, состояние, адрес Safe и.т.д.)

### Безопасность

- Подписи хранятся только в приватном IPFS Pinata
- Доступ к подписям возможен только при наличии Pinata API ключа
- Приложение не хранит подписи на бекенде
- Используются официальные аудированные контракты Gnosis

## Сравнение

| Параметр | Simple Safe UI | Gnosis toolkit |
|----------|----------------|----------------|
| **Бекенд** | ✅ Не требуется | ❌ Обязателен |
| **Настройка** | ✅ Легкая | ❌ Сложная |
| **Ресурсы** | ✅ Минимальные | ❌ Высокие |
| **Независимое хранилище** | ✅ Pinata IPFS | ⚠️ БД Safe |
| **Координация владельцев** | ⚠️ Нужна | ✅ Не требуется |
| **Валидация solidity input** | ✅ Надежная (viem) | ⚠️ Устаревшая (web3.js) |
| **Официальные контракты** | ✅ Да | ✅ Да |
| **Race condition** | ❌ Есть риск | ✅ Исключено |

**Примечание об ограничениях:**

- **Координация владельцев**: Владельцам кошелька необходимо обменяться ключом от Pinata для совместной работы с транзакциями. Кроме того, когда Safe аккаунт создается одним владельцем, он не появится автоматически у остальных — им нужно вручную добавить аккаунт в свой интерфейс.

- **Race condition**: Существует риск одновременного выполнения транзакции несколькими владельцами, что может привести к конфликтам или неожиданному поведению.

## Разработка

### Запуск тестов

```bash
npm test
```

### Линтинг

```bash
npm run lint
```

## Поддержка

Для вопросов и предложений создавайте issues в репозитории проекта.
